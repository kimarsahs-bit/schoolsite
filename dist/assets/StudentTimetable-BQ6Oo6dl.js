import{u as S,r as n,s as C,j as e,m as c,B as h,g}from"./index-vcAYm6vD.js";import{A}from"./arrow-left-DhQ25n61.js";import{H as L}from"./house-ClAQJ8-A.js";import{R as v}from"./refresh-cw-CAHL2gzR.js";import{C as f}from"./clock-B1zj3MLd.js";import{C as B}from"./calendar-Cyjlwh6t.js";import{B as T}from"./book-open-Cck4FFnk.js";const P=()=>{const d=S(),[s,j]=n.useState(null),[b,i]=n.useState([]),[k,u]=n.useState(!0),[y,N]=n.useState("");n.useEffect(()=>{(async()=>{const m=localStorage.getItem("studentEmail");if(!m){d("/student-auth");return}const t=(await g("royal-academy-auth-students",[])).find(a=>a.email===m);if(t)j(t),await p(t.class,t.section);else{const o=(await g("royal-academy-students",[])).find(x=>x.email===m);o&&(j(o),await p(o.class,o.section))}u(!1)})()},[d]);const p=async(r,m)=>{if(!r||!m){console.log("No class or section data"),i([]);return}const l=`${r}${m}`,t=`royal-academy-timetable-${l}`;console.log("Loading timetable for:",l);try{const a=await g(t,{class:r,section:m,schedule:[]});console.log("Loaded timetable:",a),a.schedule&&Array.isArray(a.schedule)?a.schedule.some(x=>x.periods&&x.periods.length>0)?(i(a.schedule),N(a.lastUpdated||new Date().toISOString())):i([]):i([])}catch(a){console.error("Error loading timetable:",a),i([])}};n.useEffect(()=>{if(!(s!=null&&s.class)||!(s!=null&&s.section))return;const m=`royal-academy-timetable-${`${s.class}${s.section}`}`,l=C(m,t=>{console.log("Timetable updated in real-time:",t),t.schedule&&Array.isArray(t.schedule)&&(i(t.schedule),N(t.lastUpdated||new Date().toISOString()))});return()=>l()},[s]);const w=async()=>{s!=null&&s.class&&(s!=null&&s.section)&&(u(!0),await p(s.class,s.section),u(!1))};return k?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-muted/20 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-gold mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading your timetable..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-muted/20",children:[e.jsx(c.header,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-card/95 backdrop-blur-md border-b border-border/50 sticky top-0 z-50",children:e.jsx("div",{className:"container-wide py-2 sm:py-4 px-2 sm:px-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-4",children:[e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>d("/student-dashboard"),className:"text-xs sm:text-sm h-8 sm:h-9 px-2 sm:px-3",children:[e.jsx(A,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Back to Dashboard"}),e.jsx("span",{className:"sm:hidden",children:"Back"})]}),e.jsxs(h,{variant:"ghost",size:"sm",onClick:()=>d("/"),className:"text-xs sm:text-sm h-8 sm:h-9 px-2 sm:px-3",children:[e.jsx(L,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Home"}),e.jsx("span",{className:"sm:hidden",children:"Home"})]})]}),e.jsx("div",{className:"flex items-center space-x-2 sm:space-x-4",children:e.jsxs(h,{variant:"outline",size:"sm",onClick:w,className:"text-xs sm:text-sm h-8 sm:h-9 px-2 sm:px-3",children:[e.jsx(v,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Refresh"}),e.jsx("span",{className:"sm:hidden",children:"Sync"})]})})]})})}),e.jsx("div",{className:"container-wide py-4 sm:py-8 px-2 sm:px-4",children:e.jsxs(c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mb-4 sm:mb-8",children:[e.jsxs("div",{className:"text-center mb-4 sm:mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 sm:w-16 sm:h-16 rounded-full bg-gradient-to-r from-royal to-gold mb-3 sm:mb-4",children:e.jsx(f,{className:"h-6 w-6 sm:h-8 sm:w-8 text-white"})}),e.jsxs("h1",{className:"text-2xl sm:text-4xl font-heading font-bold mb-2",children:["My Class ",e.jsx("span",{className:"text-gradient-gold",children:"Timetable"})]}),s&&e.jsxs("p",{className:"text-base sm:text-xl text-muted-foreground",children:["Class ",s.class,s.section," â€¢ Weekly Schedule"]}),y&&e.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground mt-2",children:["Last updated: ",new Date(y).toLocaleString()]})]}),b&&b.length>0?e.jsx("div",{className:"space-y-4 sm:space-y-6",children:b.map((r,m)=>{var l;return e.jsxs(c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:m*.1},className:"bg-card/95 backdrop-blur-md rounded-xl p-3 sm:p-6 border border-border/50 hover:shadow-lg transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 sm:mb-4",children:[e.jsxs("h3",{className:"text-lg sm:text-2xl font-heading font-bold text-foreground flex items-center gap-1 sm:gap-2",children:[e.jsx(B,{className:"h-4 w-4 sm:h-6 sm:w-6 text-gold"}),r.day]}),e.jsxs("span",{className:"text-xs sm:text-sm text-muted-foreground bg-muted/30 px-2 sm:px-3 py-1 rounded-full",children:[((l=r.periods)==null?void 0:l.length)||0," periods"]})]}),r.periods&&r.periods.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3 sm:gap-4",children:r.periods.map((t,a)=>e.jsxs(c.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:m*.1+a*.05},className:`p-3 sm:p-4 rounded-lg border transition-all ${t.subject==="Break"||t.subject==="Lunch Break"?"bg-blue-500/10 border-blue-500/30":"bg-gradient-to-br from-royal/5 to-gold/5 border-border/30 hover:border-gold/50 hover:shadow-md"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2 sm:mb-3 gap-2",children:[e.jsxs("span",{className:"text-xs sm:text-sm font-medium text-gold flex items-center gap-1 flex-shrink-0",children:[e.jsx(f,{className:"h-3 w-3 sm:h-4 sm:w-4"}),t.time]}),t.room&&e.jsx("span",{className:"text-[10px] sm:text-xs text-muted-foreground bg-muted/30 px-1.5 sm:px-2 py-0.5 sm:py-1 rounded text-right",children:t.room})]}),e.jsx("h5",{className:`font-semibold mb-1 sm:mb-2 text-sm sm:text-base break-words ${t.subject==="Break"||t.subject==="Lunch Break"?"text-blue-400":"text-foreground"}`,children:t.subject}),t.teacher&&e.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground flex items-center gap-1 break-words",children:[e.jsx(T,{className:"h-3 w-3 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:t.teacher})]})]},a))}):e.jsx("div",{className:"text-center py-6 sm:py-8",children:e.jsxs("p",{className:"text-muted-foreground text-sm sm:text-base",children:["No periods scheduled for ",r.day]})})]},r.day)})}):e.jsxs(c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center py-12 sm:py-16 bg-card/95 backdrop-blur-md rounded-xl border border-border/50",children:[e.jsx(f,{className:"h-16 w-16 sm:h-20 sm:w-20 mx-auto mb-4 sm:mb-6 text-muted-foreground opacity-50"}),e.jsx("h3",{className:"text-xl sm:text-2xl font-heading font-bold text-foreground mb-3 sm:mb-4",children:"No Timetable Available"}),e.jsx("p",{className:"text-muted-foreground mb-2 max-w-md mx-auto text-sm sm:text-base px-4",children:"Your class timetable hasn't been created yet by the Principal."}),s&&e.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground px-4",children:["Class ",s.class,s.section," timetable will appear here once created."]}),e.jsxs(h,{onClick:w,className:"mt-4 sm:mt-6 bg-gradient-to-r from-royal to-gold text-white text-sm sm:text-base",children:[e.jsx(v,{className:"h-4 w-4 mr-2"}),"Check Again"]})]})]})})]})};export{P as default};
