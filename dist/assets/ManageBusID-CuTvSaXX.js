import{u as O,r as m,j as e,m as y,B as n,X as Q,g as f,a as C,l as d}from"./index-vcAYm6vD.js";import{I as h}from"./input-CVoIJ2zH.js";import{T as J,a as K,b as S,c as j,d as X,e as x,A as Y,f as V,B as W}from"./avatar-CGCYeeC4.js";import{B as k}from"./badge-LmcNerN7.js";import{C as N,a as v,b as g,d as b,c as Z}from"./card-yB6fowr0.js";import{A as _}from"./arrow-left-DhQ25n61.js";import{P as $}from"./plus-CSXBcpgr.js";import{B as ee}from"./bus-BTxqp6us.js";import{S as E}from"./search-DaWYlKik.js";import{S as se}from"./square-pen-BVw1FIsV.js";import{R as ae}from"./refresh-cw-CAHL2gzR.js";import{T as te}from"./trash-2-04KiNg8K.js";import{S as re}from"./save-5ZuEQXRf.js";const c="royal-academy-auth-buses",ge=()=>{const D=O(),[w,u]=m.useState([]),[A,L]=m.useState(""),[T,P]=m.useState(!0),[ie,le]=m.useState(null),[R,p]=m.useState(!1),[i,o]=m.useState(null),z=(localStorage.getItem("principalEmail")||"principal.1025@gmail.com").trim().toLowerCase();m.useEffect(()=>{const s=async()=>{try{const r=(await f(c,[])||[]).filter(l=>(l.owner||"").toLowerCase()===z);u(r)}catch(t){console.error(t),u([])}P(!1)};s();const a=t=>{t.key===c&&s()};return window.addEventListener("storage",a),()=>window.removeEventListener("storage",a)},[]);const I=w.filter(s=>{const a=A.trim().toLowerCase();return a?(s.username||"").toLowerCase().includes(a)||(s.busId||"").toLowerCase().includes(a)||(s.busNumber||"").toLowerCase().includes(a)||(s.routeName||"").toLowerCase().includes(a):!0}),F=()=>{const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let a="";for(let t=0;t<8;t++)a+=s.charAt(Math.floor(Math.random()*s.length));return a},M=async s=>{const a=F();try{const r=(await f(c,[])||[]).map(l=>l.id===s?{...l,password:a,loginAttempts:0}:l);await C(c,r),u(l=>l.map(B=>B.id===s?{...B,password:a,loginAttempts:0}:B)),d.success(`Password reset: ${a}`)}catch(t){console.error(t),d.error("Failed to reset password")}},q=async s=>{try{const t=(await f(c,[])||[]).map(r=>r.id===s?{...r,status:r.status==="banned"?"active":"banned"}:r);await C(c,t),u(r=>r.map(l=>l.id===s?{...l,status:l.status==="banned"?"active":"banned"}:l)),d.success("Status updated")}catch(a){console.error(a),d.error("Failed to update status")}},H=async s=>{if(window.confirm("Delete this bus ID? This will remove its login access."))try{const t=(await f(c,[])||[]).filter(r=>r.id!==s);await C(c,t),u(r=>r.filter(l=>l.id!==s)),d.success("Bus ID deleted")}catch(a){console.error(a),d.error("Failed to delete")}},U=s=>{o({...s}),p(!0)},G=async()=>{if(i)try{const a=(await f(c,[])||[]).map(t=>t.id===i.id?{...i}:t);await C(c,a),u(t=>t.map(r=>r.id===i.id?{...i}:r)),p(!1),o(null),d.success("Bus details updated")}catch(s){console.error(s),d.error("Failed to update")}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-royal via-royal/90 to-gold/20 p-4",children:e.jsxs("div",{className:"container mx-auto max-w-7xl",children:[e.jsxs(y.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>D("/principal-dashboard"),className:"rounded-full text-white hover:bg-white/10",title:"Go Back",children:e.jsx(_,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Manage Bus IDs"}),e.jsx("p",{className:"text-white/80",children:"Edit, ban/unban, or delete bus tracker accounts"})]})]}),e.jsxs(n,{onClick:()=>D("/create-bus-id"),variant:"outline",className:"gap-2 text-white border-white/20 hover:bg-white/10",children:[e.jsx($,{className:"h-4 w-4"}),"Go to Create Bus ID"]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4 mb-6",children:[e.jsxs(N,{className:"bg-card/95 backdrop-blur-md border-border/50",children:[e.jsxs(v,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(g,{className:"text-sm font-medium",children:"Total Bus IDs"}),e.jsx(ee,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold",children:w.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total registered IDs"})]})]}),e.jsxs(N,{className:"bg-card/95 backdrop-blur-md border-border/50",children:[e.jsxs(v,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(g,{className:"text-sm font-medium",children:"Active"}),e.jsx(k,{children:"ON"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold",children:w.filter(s=>s.status==="active").length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Can login"})]})]}),e.jsxs(N,{className:"bg-card/95 backdrop-blur-md border-border/50",children:[e.jsxs(v,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(g,{className:"text-sm font-medium",children:"Banned"}),e.jsx(k,{variant:"destructive",children:"OFF"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold",children:w.filter(s=>s.status==="banned").length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Access blocked"})]})]}),e.jsxs(N,{className:"bg-card/95 backdrop-blur-md border-border/50",children:[e.jsxs(v,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(g,{className:"text-sm font-medium",children:"Search"}),e.jsx(E,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(b,{children:e.jsxs("div",{className:"relative",children:[e.jsx(E,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(h,{type:"search",placeholder:"Search by user, ID, route...",className:"pl-8",value:A,onChange:s=>L(s.target.value)})]})})]})]}),e.jsx(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:e.jsxs(N,{className:"bg-card/95 backdrop-blur-md border-border/50",children:[e.jsx(v,{children:e.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:e.jsxs("div",{children:[e.jsx(g,{children:"Bus Login IDs"}),e.jsx(Z,{children:"Manage bus tracker authentication and access"})]})})}),e.jsx(b,{children:T?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"})}):e.jsx("div",{className:"rounded-md border",children:e.jsxs(J,{children:[e.jsx(K,{children:e.jsxs(S,{children:[e.jsx(j,{children:"Account"}),e.jsx(j,{children:"Bus ID"}),e.jsx(j,{children:"Route"}),e.jsx(j,{children:"Status"}),e.jsx(j,{children:"Created"}),e.jsx(j,{className:"text-right",children:"Actions"})]})}),e.jsx(X,{children:I.length>0?I.map(s=>{var a;return e.jsxs(S,{children:[e.jsx(x,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Y,{className:"h-9 w-9",children:e.jsx(V,{children:(a=(s.username||"B")[0])==null?void 0:a.toUpperCase()})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.username}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.busNumber||"N/A"})]})]})}),e.jsx(x,{children:e.jsx("code",{className:"text-sm bg-muted px-2 py-1 rounded",children:s.busId})}),e.jsx(x,{children:s.routeName||"N/A"}),e.jsx(x,{children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(k,{variant:s.status==="banned"?"destructive":"default",children:s.status==="banned"?"Banned":"Active"})})}),e.jsx(x,{children:new Date(s.createdAt).toLocaleDateString()}),e.jsx(x,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-1",children:[e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>U(s),title:"Edit",children:e.jsx(se,{className:"h-4 w-4"})}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>M(s.id),title:"Reset Password",className:"text-purple-600 hover:text-purple-700",children:e.jsx(ae,{className:"h-4 w-4"})}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>q(s.id),title:s.status==="banned"?"Activate":"Ban",className:s.status==="banned"?"text-green-600 hover:text-green-700":"text-red-600 hover:text-red-700",children:e.jsx(W,{className:"h-4 w-4"})}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>H(s.id),title:"Delete",className:"text-destructive hover:text-destructive",children:e.jsx(te,{className:"h-4 w-4"})})]})})]},s.id)}):e.jsx(S,{children:e.jsx(x,{colSpan:6,className:"h-24 text-center",children:"No bus IDs found."})})})]})})})]})}),R&&i&&e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",onClick:()=>p(!1),children:e.jsxs(y.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-card rounded-2xl shadow-2xl border border-border/50 w-full max-w-md",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-border/50",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Edit Bus Account"}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>p(!1),className:"rounded-full",children:e.jsx(Q,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"p-6",children:e.jsxs("form",{onSubmit:s=>{s.preventDefault(),G()},children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Username"}),e.jsx(h,{value:i.username,onChange:s=>o({...i,username:s.target.value}),placeholder:"tracker.username",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Route Name"}),e.jsx(h,{value:i.routeName||"",onChange:s=>o({...i,routeName:s.target.value}),placeholder:"Route"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Bus Number"}),e.jsx(h,{value:i.busNumber||"",onChange:s=>o({...i,busNumber:s.target.value}),placeholder:"RJ14-1234"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Driver Name"}),e.jsx(h,{value:i.driverName||"",onChange:s=>o({...i,driverName:s.target.value}),placeholder:"Name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Driver Phone"}),e.jsx(h,{value:i.driverPhone||"",onChange:s=>o({...i,driverPhone:s.target.value}),placeholder:"+91-..."})]})]}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsxs(n,{type:"submit",className:"flex-1",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Save Changes"]}),e.jsx(n,{type:"button",variant:"outline",onClick:()=>p(!1),children:"Cancel"})]})]})})]})})]})})};export{ge as default};
