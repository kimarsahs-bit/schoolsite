import{c as ie,r as o,s as T,l,g as ce,j as e,A as ne,m as u,X as U,a as de}from"./index-vcAYm6vD.js";import{B as i}from"./button-variants-BtDv6DLU.js";import{I as d}from"./input-CVoIJ2zH.js";import{T as me}from"./textarea-B1JbTjEM.js";import{S,d as P,e as E,f as F,g as p}from"./select-BHw13X9t.js";import{A as xe,a as he}from"./alert-BYJYiRk6.js";import{l as ue,a as pe,u as fe,d as je}from"./booksHelper-CI04GjtC.js";import{E as ge}from"./eye-off-DPvmRXZA.js";import{E as D}from"./eye-CF1wM1sA.js";import{P as be}from"./plus-CSXBcpgr.js";import{F as ye}from"./filter-Cf7tfofv.js";import{U as ve}from"./upload-DXS06rhK.js";import{S as Ne}from"./save-5ZuEQXRf.js";import{B as q}from"./book-open-Cck4FFnk.js";import{S as we}from"./square-pen-BVw1FIsV.js";import{T as ke}from"./trash-2-04KiNg8K.js";import{C as Ye}from"./calendar-Cyjlwh6t.js";import{E as Ce}from"./external-link-D61icv-P.js";import"./index-XrueaTAc.js";import"./chevron-down-D_kuZwQK.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=ie("CalendarPlus",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M21 13V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8",key:"3spt84"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M16 19h6",key:"xwg31i"}],["path",{d:"M19 16v6",key:"tddt3s"}]]),We=()=>{const[M,I]=o.useState([]),[$,m]=o.useState(!1),[r,f]=o.useState(null),[b,y]=o.useState(!1),[x,H]=o.useState(!1),[L,h]=o.useState(""),[v,O]=o.useState("all"),[N,K]=o.useState("all"),[W,_]=o.useState(!0),[X,j]=o.useState(!1),[w,k]=o.useState(""),[Be,Y]=o.useState(null),[z,C]=o.useState(""),[B,A]=o.useState([]);o.useEffect(()=>{g(),G();const s=T("royal-academy-yearly-books",t=>{console.log("[YearlyBookManager] Received realtime update for books"),I(t)}),a=T("royal-academy-available-years",t=>{console.log("[YearlyBookManager] Received realtime update for years"),A(t)});return()=>{s(),a()}},[]);const g=async()=>{_(!0);try{const s=await ue();I(s)}catch(s){console.error("Error loading books:",s),l.error("Failed to load books")}finally{_(!1)}},G=async()=>{try{const s=await ce("royal-academy-available-years",[]);A(s)}catch(s){console.error("[YearlyBookManager] Error loading years:",s)}},J=()=>{f({class:1,year:"",title:"",author:"",description:"",buying_link:""}),y(!0),m(!0),Y(null),C("")},Q=()=>{k(""),j(!0)},Z=async()=>{if(!/^\d{4}-\d{4}$/.test(w.trim())){l.error("Year must be in academic year format (e.g., 2024-2025)");return}const a=w.trim();if(B.includes(a))l.error(`Academic year ${a} already exists.`);else{const t=[...B,a].sort();A(t),await de("royal-academy-available-years",t),l.success(`Academic year ${a} created!`)}j(!1),k("")},ee=s=>{var t;const a=(t=s.target.files)==null?void 0:t[0];if(a){if(!a.type.startsWith("image/")){l.error("Please upload an image file");return}if(a.size>5*1024*1024){l.error("Image size should be less than 5MB");return}Y(a);const c=new FileReader;c.onloadend=()=>{C(c.result),n("cover_photo",c.result)},c.readAsDataURL(a)}},se=s=>{f({...s}),y(!1),m(!0),Y(null),C(s.cover_photo||"")},ae=s=>{try{return new URL(s),!0}catch{return!1}},te=s=>{if(!/^\d{4}-\d{4}$/.test(s))return!1;const[t,c]=s.split("-").map(Number);return c===t+1},re=async()=>{if(r){if(!r.title.trim()){l.error("Title is required");return}if(!r.author.trim()){l.error("Author is required");return}if(!r.description.trim()){l.error("Description is required");return}if(!r.year.trim()){l.error("Year is required");return}if(!te(r.year)){l.error("Year must be in academic year format (e.g., 2024-2025)");return}if(!r.buying_link.trim()){l.error("Buying link is required");return}if(!ae(r.buying_link)){l.error("Please enter a valid URL for the buying link");return}if(r.class<1||r.class>12){l.error("Class must be between 1 and 12");return}try{if(b){const{id:s,createdAt:a,...t}=r;await pe(t)?(await g(),l.success("Book added successfully!"),h("Book added successfully!")):l.error("Failed to add book")}else await fe(r.id,r)?(await g(),l.success("Book updated successfully!"),h("Book updated successfully!")):l.error("Failed to update book");m(!1),f(null),y(!1),setTimeout(()=>h(""),3e3)}catch(s){console.error("Error saving book:",s),l.error("An error occurred while saving the book")}}},le=async s=>{if(confirm("Are you sure you want to delete this book?"))try{await je(s)?(await g(),l.success("Book deleted successfully!"),h("Book deleted successfully!"),setTimeout(()=>h(""),3e3)):l.error("Failed to delete book")}catch(a){console.error("Error deleting book:",a),l.error("An error occurred while deleting the book")}},n=(s,a)=>{r&&f({...r,[s]:a})},R=M.filter(s=>{const a=v==="all"||s.class.toString()===v,t=N==="all"||s.year===N;return a&&t});Array.from(new Set(M.map(s=>s.year))).sort();const oe=R.reduce((s,a)=>{const t=`Class ${a.class}`;return s[t]||(s[t]=[]),s[t].push(a),s},{});return e.jsxs("div",{className:"space-y-4 sm:space-y-6 p-2 sm:p-4",children:[e.jsxs("div",{className:"flex flex-col space-y-3 sm:space-y-4 lg:flex-row lg:items-center lg:justify-between lg:space-y-0",children:[e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("h2",{className:"text-lg sm:text-xl lg:text-2xl font-heading font-bold text-foreground",children:"Yearly Book Manager"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground mt-1",children:"Manage recommended books for classes 1-12"})]}),e.jsxs("div",{className:"flex flex-col space-y-2 sm:flex-row sm:items-center sm:space-y-0 sm:space-x-2 lg:space-x-3",children:[e.jsxs(i,{onClick:()=>H(!x),variant:"outline",size:"sm",className:"w-full sm:w-auto text-xs sm:text-sm h-8 sm:h-9",children:[x?e.jsx(ge,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}):e.jsx(D,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),e.jsx("span",{className:"hidden xs:inline",children:x?"Hide Preview":"Show Preview"}),e.jsx("span",{className:"xs:hidden",children:x?"Hide":"Preview"})]}),e.jsxs(i,{onClick:Q,variant:"outline",size:"sm",className:"w-full sm:w-auto text-xs sm:text-sm h-8 sm:h-9",children:[e.jsx(V,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),e.jsx("span",{className:"hidden xs:inline",children:"Create Year"}),e.jsx("span",{className:"xs:hidden",children:"Add Year"})]}),e.jsxs(i,{onClick:J,className:"w-full sm:w-auto bg-gradient-to-r from-royal to-gold text-white text-xs sm:text-sm h-8 sm:h-9",children:[e.jsx(be,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),e.jsx("span",{className:"hidden xs:inline",children:"Add Book"}),e.jsx("span",{className:"xs:hidden",children:"Add"})]})]})]}),L&&e.jsx(xe,{className:"mx-2 sm:mx-0",children:e.jsx(he,{className:"text-xs sm:text-sm",children:L})}),e.jsxs("div",{className:"bg-card border border-border rounded-lg p-3 sm:p-4 mx-2 sm:mx-0",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3 sm:mb-4",children:[e.jsx(ye,{className:"h-3 w-3 sm:h-4 sm:w-4 text-muted-foreground"}),e.jsx("h3",{className:"text-xs sm:text-sm font-semibold text-foreground",children:"Filters"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium mb-1 sm:mb-2 block",children:"Filter by Class"}),e.jsxs(S,{value:v,onValueChange:O,children:[e.jsx(P,{className:"h-8 sm:h-9 text-xs sm:text-sm",children:e.jsx(E,{placeholder:"All Classes"})}),e.jsxs(F,{children:[e.jsx(p,{value:"all",children:"All Classes"}),Array.from({length:12},(s,a)=>a+1).map(s=>e.jsxs(p,{value:s.toString(),children:["Class ",s]},s))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium mb-1 sm:mb-2 block",children:"Filter by Academic Year"}),e.jsxs(S,{value:N,onValueChange:K,children:[e.jsx(P,{className:"h-8 sm:h-9 text-xs sm:text-sm",children:e.jsx(E,{placeholder:"All Years"})}),e.jsxs(F,{children:[e.jsx(p,{value:"all",children:"All Years"}),B.map(s=>e.jsx(p,{value:s,children:s},s))]})]})]})]})]}),e.jsxs(ne,{children:[X&&e.jsx(u.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs(u.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-card rounded-lg sm:rounded-xl p-3 sm:p-4 lg:p-6 w-full max-w-xs sm:max-w-md mx-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-heading font-bold",children:"Create Academic Year"}),e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>j(!1),className:"h-8 w-8 p-0",children:e.jsx(U,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium mb-2 block",children:["Academic Year ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{value:w,onChange:s=>k(s.target.value),placeholder:"e.g., 2024-2025"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Format: YYYY-YYYY (e.g., 2024-2025)"})]})}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 mt-6 pt-6 border-t",children:[e.jsx(i,{variant:"outline",onClick:()=>j(!1),children:"Cancel"}),e.jsxs(i,{onClick:Z,className:"bg-gradient-to-r from-royal to-gold text-white",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Create Year"]})]})]})}),$&&r&&e.jsx(u.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs(u.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-card rounded-lg sm:rounded-xl p-4 sm:p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-heading font-bold",children:b?"Add New Book":"Edit Book"}),e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>m(!1),className:"h-8 w-8 p-0",children:e.jsx(U,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium mb-2 block",children:["Class ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(S,{value:r.class.toString(),onValueChange:s=>n("class",parseInt(s)),children:[e.jsx(P,{children:e.jsx(E,{})}),e.jsx(F,{children:Array.from({length:12},(s,a)=>a+1).map(s=>e.jsxs(p,{value:s.toString(),children:["Class ",s]},s))})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium mb-2 block",children:["Academic Year ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{value:r.year,onChange:s=>n("year",s.target.value),placeholder:"e.g., 2024-2025"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Format: YYYY-YYYY"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium mb-2 block",children:["Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{value:r.title,onChange:s=>n("title",s.target.value),placeholder:"Enter book title"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium mb-2 block",children:["Author ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{value:r.author,onChange:s=>n("author",s.target.value),placeholder:"Enter author name"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium mb-2 block",children:["Description ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(me,{value:r.description,onChange:s=>n("description",s.target.value),placeholder:"Enter book description and why it's recommended",rows:4})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium mb-2 block",children:["Book Cover Photo ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{type:"file",accept:"image/*",onChange:ee,className:"flex-1",id:"cover-photo-upload"}),e.jsxs(i,{type:"button",variant:"outline",size:"sm",onClick:()=>{var s;return(s=document.getElementById("cover-photo-upload"))==null?void 0:s.click()},children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Upload"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Upload an image file for the book cover (max 5MB)"}),z&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:z,alt:"Book cover preview",className:"w-32 h-44 object-cover rounded border shadow-md"})})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium mb-2 block",children:["Buying Link ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{value:r.buying_link,onChange:s=>n("buying_link",s.target.value),placeholder:"https://example.com/book",type:"url"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Enter a valid URL where students can purchase the book"})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 mt-6 pt-6 border-t",children:[e.jsx(i,{variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsxs(i,{onClick:re,className:"bg-gradient-to-r from-royal to-gold text-white",children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"}),b?"Add":"Update"," Book"]})]})]})})]}),e.jsx("div",{className:"space-y-6",children:W?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(q,{className:"h-16 w-16 mx-auto mb-4 opacity-50 animate-pulse"}),e.jsx("p",{children:"Loading books..."})]}):R.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(q,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"font-semibold mb-2",children:"No books available for the selected criteria."}),e.jsx("p",{className:"text-sm",children:'Click "Add Book" to add recommended books for students.'})]}):Object.entries(oe).sort((s,a)=>{const t=parseInt(s[0].replace("Class ","")),c=parseInt(a[0].replace("Class ",""));return t-c}).map(([s,a])=>e.jsxs("div",{className:"bg-card border border-border rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-500 p-4",children:e.jsxs("h3",{className:"text-xl font-heading font-bold text-white",children:[s," (",a.length," ",a.length===1?"book":"books",")"]})}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:a.map(t=>e.jsxs(u.div,{layout:!0,className:"bg-background/50 border border-border rounded-lg p-4 hover:shadow-md transition-all duration-200",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[t.cover_photo&&e.jsx("img",{src:t.cover_photo,alt:t.title,className:"w-16 h-20 object-cover rounded border flex-shrink-0",onError:c=>{c.currentTarget.style.display="none"}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-foreground mb-1",children:t.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["by ",t.author]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(i,{variant:"outline",size:"sm",onClick:()=>se(t),className:"h-8 w-8 p-0",children:e.jsx(we,{className:"h-3 w-3"})}),e.jsx(i,{variant:"outline",size:"sm",onClick:()=>le(t.id),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700",children:e.jsx(ke,{className:"h-3 w-3"})})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3 line-clamp-2",children:t.description}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center space-x-1 text-muted-foreground",children:[e.jsx(Ye,{className:"h-3 w-3"}),e.jsx("span",{children:t.year})]}),e.jsxs("a",{href:t.buying_link,target:"_blank",rel:"noopener noreferrer",className:"flex items-center space-x-1 text-blue-600 hover:text-blue-700 transition-colors",children:[e.jsx("span",{children:"Buy Book"}),e.jsx(Ce,{className:"h-3 w-3"})]})]})]},t.id))})})]},s))}),x&&e.jsx("div",{className:"bg-card border border-border rounded-lg p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between space-y-3 sm:space-y-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-foreground",children:"Live Preview"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"View how books appear to students"})]}),e.jsxs(i,{variant:"outline",className:"w-full sm:w-auto",children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Preview Book List"]})]})})]})};export{We as default};
