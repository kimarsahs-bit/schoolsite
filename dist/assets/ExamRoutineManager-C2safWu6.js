import{r as l,s as de,l as i,j as e,m as j,A as me,X as ce}from"./index-vcAYm6vD.js";import{B as c}from"./button-variants-BtDv6DLU.js";import{I as D}from"./input-CVoIJ2zH.js";import{T as xe}from"./textarea-B1JbTjEM.js";import{S as q,d as O,e as J,f as U,g as w}from"./select-BHw13X9t.js";import{C as ge}from"./checkbox-B49lUdcQ.js";import{A as he,a as ue}from"./alert-BYJYiRk6.js";import{l as ye,d as be,u as fe,a as pe}from"./examRoutinesHelper-DJ1zbqdB.js";import{C as je}from"./calendar-Cyjlwh6t.js";import{P as we}from"./plus-CSXBcpgr.js";import{C as ke}from"./circle-alert-D_zFa0RS.js";import{S as Ne}from"./square-pen-BVw1FIsV.js";import{T as ve}from"./trash-2-04KiNg8K.js";import{S as Ce}from"./save-5ZuEQXRf.js";import{C as Se}from"./chevron-left-CY1VkQV5.js";import{C as De}from"./chevron-right-A6kZWk8r.js";import"./index-XrueaTAc.js";import"./chevron-down-D_kuZwQK.js";const Be=()=>{const[k,_]=l.useState([]),[E,V]=l.useState([]),[o,u]=l.useState(new Date().getMonth()),[x,A]=l.useState(new Date().getFullYear()),[_e,M]=l.useState(null),[B,d]=l.useState(!1),[N,v]=l.useState(!1),[R,C]=l.useState(null),[W,F]=l.useState(!0),[y,X]=l.useState("All"),[b,G]=l.useState(""),T=l.useRef(null),P=l.useRef(null),[t,m]=l.useState({date:"",exam_name:"",class:"All",is_holiday:!1,notes:""});l.useEffect(()=>{f();const s=de("royal-academy-exam-routines",a=>{console.log("[ExamRoutineManager] Received realtime update"),_(a)});return()=>{s()}},[]),l.useEffect(()=>{K()},[k,y,b]);const I=()=>{const s=T.current;s&&(typeof s.showPicker=="function"?s.showPicker():s.focus())},H=()=>{const s=P.current;s&&(typeof s.showPicker=="function"?s.showPicker():s.focus())},f=async()=>{F(!0);try{const s=await ye();_(s)}catch(s){console.error("Error loading exam routines:",s),i.error("Failed to load exam routines")}finally{F(!1)}},K=()=>{let s=[...k];if(y!=="All"&&(s=s.filter(a=>a.class===y||a.class==="All")),b){const[a,n]=b.split("-").map(Number);s=s.filter(h=>{const r=new Date(h.date);return r.getFullYear()===a&&r.getMonth()+1===n})}s.sort((a,n)=>new Date(a.date).getTime()-new Date(n.date).getTime()),V(s)},Q=(s,a)=>new Date(a,s+1,0).getDate(),Z=(s,a)=>new Date(a,s,1).getDay(),ee=()=>{o===0?(u(11),A(x-1)):u(o-1)},se=()=>{o===11?(u(0),A(x+1)):u(o+1)},$=s=>k.filter(a=>{const n=new Date(a.date);return n.getDate()===s.getDate()&&n.getMonth()===s.getMonth()&&n.getFullYear()===s.getFullYear()}),ae=s=>{const a=new Date(x,o,s);M(a);const n=a.getFullYear(),h=String(a.getMonth()+1).padStart(2,"0"),r=String(a.getDate()).padStart(2,"0"),p=`${n}-${h}-${r}`,g=$(a);g.length===1?Y(g[0]):(m({date:p,exam_name:"",class:"All",is_holiday:!1,notes:""}),v(!1),C(null),d(!0))},te=()=>{m({date:"",exam_name:"",class:"All",is_holiday:!1,notes:""}),M(null),v(!1),C(null),d(!0)},Y=s=>{C(s),m({date:s.date.split("T")[0],exam_name:s.exam_name,class:s.class,is_holiday:s.is_holiday,notes:s.notes}),v(!0),d(!0)},re=async()=>{if(!t.date){i.error("Please select a date");return}if(!t.is_holiday&&!t.exam_name.trim()){i.error("Exam name is required");return}t.is_holiday&&!t.exam_name.trim()&&(t.exam_name="Holiday");try{N&&R?await fe(R.id,{date:new Date(t.date).toISOString(),exam_name:t.exam_name,class:t.class,is_holiday:t.is_holiday,notes:t.notes})?(i.success("Exam routine updated successfully!"),await f(),d(!1)):i.error("Failed to update exam routine"):await pe({date:new Date(t.date).toISOString(),exam_name:t.exam_name,class:t.class,is_holiday:t.is_holiday,notes:t.notes})?(i.success("Exam routine added successfully!"),await f(),d(!1)):i.error("Failed to add exam routine")}catch(s){console.error("Error saving exam routine:",s),i.error("An error occurred while saving")}},le=async s=>{if(confirm("Are you sure you want to delete this entry?"))try{await be(s)?(i.success("Entry deleted successfully!"),await f()):i.error("Failed to delete entry")}catch(a){console.error("Error deleting exam routine:",a),i.error("An error occurred while deleting")}},ne=()=>{const s=Q(o,x),a=Z(o,x),n=[],h=["January","February","March","April","May","June","July","August","September","October","November","December"];for(let r=0;r<a;r++)n.push(e.jsx("div",{className:"aspect-square"},`empty-${r}`));for(let r=1;r<=s;r++){const p=new Date(x,o,r),g=$(p),z=g.some(S=>!S.is_holiday),L=g.some(S=>S.is_holiday),oe=p.toDateString()===new Date().toDateString();n.push(e.jsxs(j.div,{whileHover:{scale:1.05},className:`
            aspect-square border-2 rounded-lg p-1 sm:p-2 cursor-pointer relative
            text-xs sm:text-sm font-medium text-gray-900 dark:text-gray-100
            transition-all
            ${oe?"border-blue-600 dark:border-blue-400 bg-blue-50 dark:bg-blue-900/20":"border-gray-800 dark:border-gray-300 bg-white dark:bg-gray-700"}
            ${z?"bg-orange-50 dark:bg-orange-900/20 border-orange-600 dark:border-orange-400":""}
            ${L?"bg-green-50 dark:bg-green-900/20 border-green-600 dark:border-green-400":""}
            hover:shadow-md active:scale-95
          `,onClick:()=>ae(r),children:[e.jsx("div",{className:"flex items-center justify-center h-full",children:r}),g.length>0&&e.jsxs("div",{className:"absolute bottom-0.5 left-0.5 right-0.5 space-y-0.5 flex gap-0.5",children:[z&&e.jsx("div",{className:"h-0.5 sm:h-1 bg-orange-500 rounded-full flex-1"}),L&&e.jsx("div",{className:"h-0.5 sm:h-1 bg-green-500 rounded-full flex-1"})]})]},r))}return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-3 sm:p-4 md:p-6 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6 gap-2",children:[e.jsx(c,{variant:"outline",size:"sm",onClick:ee,className:"h-8 w-8 sm:h-9 sm:w-9 p-0",children:e.jsx(Se,{className:"w-4 h-4 text-black dark:text-white"})}),e.jsxs("h3",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-gray-100 text-center flex-1 truncate",children:[h[o]," ",x]}),e.jsx(c,{variant:"outline",size:"sm",onClick:se,className:"h-8 w-8 sm:h-9 sm:w-9 p-0",children:e.jsx(De,{className:"w-4 h-4 text-black dark:text-white"})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 sm:gap-2 mb-1 sm:mb-2",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(r=>e.jsx("div",{className:"text-center text-xs sm:text-sm font-semibold text-gray-600 dark:text-gray-400",children:r},r))}),e.jsx("div",{className:"grid grid-cols-7 gap-1 sm:gap-2",children:n}),e.jsxs("div",{className:"mt-4 sm:mt-6 flex flex-wrap gap-2 sm:gap-4 text-xs sm:text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 sm:w-4 h-0.5 sm:h-1 bg-orange-500 rounded-full"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100 font-semibold",children:"Exam"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 sm:w-4 h-0.5 sm:h-1 bg-green-500 rounded-full"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100 font-semibold",children:"Holiday"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 sm:w-4 h-3 sm:h-4 border border-blue-500 rounded"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100 font-semibold",children:"Today"})]})]})]})},ie=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return W?e.jsx("div",{className:"flex items-center justify-center p-6 sm:p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 sm:h-12 sm:w-12 border-b-2 border-blue-600 mx-auto mb-3 sm:mb-4"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:"Loading exam routines..."})]})}):e.jsxs("div",{className:"p-3 sm:p-4 md:p-6 space-y-4 sm:space-y-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3 sm:gap-4",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("h2",{className:"text-2xl sm:text-3xl font-bold flex items-center gap-2 text-gray-900 dark:text-gray-100",children:[e.jsx(je,{className:"w-6 h-6 sm:w-8 sm:h-8 flex-shrink-0 text-black dark:text-white"}),e.jsx("span",{className:"truncate",children:"Exam Routine Manager"})]}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Manage exam schedules and holidays for all classes"})]}),e.jsxs(c,{onClick:te,className:"flex items-center justify-center gap-2 w-full sm:w-auto text-xs sm:text-sm py-2 sm:py-2",children:[e.jsx(we,{className:"w-4 h-4"}),"Add Exam/Holiday"]})]}),ne(),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-3 sm:p-4 md:p-6",children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:gap-4 mb-4 sm:mb-6",children:[e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block text-xs sm:text-sm font-semibold text-gray-900 dark:text-gray-100 mb-1.5 sm:mb-2",children:"Filter by Class"}),e.jsxs(q,{value:y,onValueChange:X,children:[e.jsx(O,{className:"text-xs sm:text-sm text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600",children:e.jsx(J,{})}),e.jsxs(U,{children:[e.jsx(w,{value:"All",children:"All Classes"}),[...Array(12)].map((s,a)=>e.jsxs(w,{value:String(a+1),children:["Class ",a+1]},a+1))]})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block text-xs sm:text-sm font-semibold text-gray-900 dark:text-gray-100 mb-1.5 sm:mb-2",children:"Filter by Month"}),e.jsx(D,{ref:T,type:"month",value:b,onChange:s=>G(s.target.value),onFocus:I,onClick:I,placeholder:"Select month",className:"text-xs sm:text-sm text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700 border-2 border-gray-400 dark:border-gray-500 font-semibold"})]})]}),e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-gray-900 dark:text-gray-100 mb-3 sm:mb-4",children:"Upcoming Exams & Holidays"}),E.length===0?e.jsxs(he,{className:"bg-blue-50 dark:bg-blue-900/20 border-blue-300 dark:border-blue-700",children:[e.jsx(ke,{className:"h-3 w-3 sm:h-4 sm:w-4 text-blue-600 dark:text-blue-400"}),e.jsx(ue,{className:"text-xs sm:text-sm text-blue-900 dark:text-blue-100 font-medium",children:'No exam routine for all classes. Click "Add Exam/Holiday" or select a date to create one.'})]}):e.jsx("div",{className:"space-y-2 sm:space-y-3",children:E.map(s=>e.jsx(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:`
                  p-3 sm:p-4 rounded-lg border-l-4 
                  ${s.is_holiday?"border-green-500 bg-green-50 dark:bg-green-900/20":"border-orange-500 bg-orange-50 dark:bg-orange-900/20"}
                `,children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-start gap-2 sm:gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1 flex-wrap",children:[e.jsx("span",{className:`
                        px-2 py-0.5 text-xs font-medium rounded
                        ${s.is_holiday?"bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100":"bg-orange-100 text-orange-800 dark:bg-orange-800 dark:text-orange-100"}
                      `,children:s.is_holiday?"Holiday":"Exam"}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:ie(s.date)})]}),e.jsx("h4",{className:"font-semibold text-sm sm:text-base break-words",children:s.exam_name}),e.jsx("div",{className:"flex gap-4 mt-1.5 sm:mt-2 text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:e.jsxs("span",{children:["Class: ",s.class]})}),s.notes&&e.jsx("p",{className:"mt-1.5 sm:mt-2 text-xs sm:text-sm text-gray-700 dark:text-gray-300",children:s.notes})]}),e.jsxs("div",{className:"flex gap-1 sm:gap-2 self-start sm:self-center",children:[e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>Y(s),className:"h-8 w-8 sm:h-9 sm:w-9 p-0",children:e.jsx(Ne,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>le(s.id),className:"h-8 w-8 sm:h-9 sm:w-9 p-0 text-red-600 hover:text-red-700",children:e.jsx(ve,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})})]})]})},s.id))})]}),e.jsx(me,{children:B&&e.jsx(j.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 flex items-end sm:items-center justify-center z-50 p-0 sm:p-4",onClick:()=>d(!1),children:e.jsx(j.div,{initial:{scale:.9,opacity:0,y:"100%"},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:"100%"},transition:{type:"spring",damping:25,stiffness:300},className:"bg-white dark:bg-gray-800 rounded-t-lg sm:rounded-lg shadow-xl w-full sm:max-w-lg sm:w-full max-h-[90vh] overflow-y-auto",onClick:s=>s.stopPropagation(),children:e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 sm:mb-6 gap-2",children:[e.jsx("h3",{className:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-gray-100 truncate",children:N?"Edit Entry":"Add Exam/Holiday"}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>d(!1),className:"h-8 w-8 sm:h-9 sm:w-9 p-0 flex-shrink-0 text-gray-900 dark:text-gray-100 hover:bg-gray-200 dark:hover:bg-gray-700",children:e.jsx(ce,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-semibold text-gray-900 dark:text-gray-100 mb-1.5 sm:mb-2",children:"Date *"}),e.jsx(D,{ref:P,type:"date",value:t.date,onChange:s=>m({...t,date:s.target.value}),onFocus:H,onClick:H,className:"text-xs sm:text-sm text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700 border-2 border-gray-400 dark:border-gray-500"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ge,{id:"is_holiday",checked:t.is_holiday,onCheckedChange:s=>m({...t,is_holiday:s})}),e.jsx("label",{htmlFor:"is_holiday",className:"text-xs sm:text-sm font-semibold text-gray-900 dark:text-gray-100 leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Mark as Holiday"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-semibold text-gray-900 dark:text-gray-100 mb-1.5 sm:mb-2",children:t.is_holiday?"Holiday Name":"Exam Name *"}),e.jsx(D,{type:"text",value:t.exam_name,onChange:s=>m({...t,exam_name:s.target.value}),placeholder:t.is_holiday?"e.g., Independence Day":"e.g., Mathematics Mid-Term",className:"text-xs sm:text-sm text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700 border-2 border-gray-400 dark:border-gray-500 placeholder:text-gray-500 dark:placeholder:text-gray-400"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-semibold text-gray-900 dark:text-gray-100 mb-1.5 sm:mb-2",children:"Class *"}),e.jsxs(q,{value:t.class,onValueChange:s=>m({...t,class:s}),children:[e.jsx(O,{className:"text-xs sm:text-sm text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700 border-2 border-gray-400 dark:border-gray-500",children:e.jsx(J,{})}),e.jsxs(U,{children:[e.jsx(w,{value:"All",children:"All Classes"}),[...Array(12)].map((s,a)=>e.jsxs(w,{value:String(a+1),children:["Class ",a+1]},a+1))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-semibold text-gray-900 dark:text-gray-100 mb-1.5 sm:mb-2",children:"Notes/Description"}),e.jsx(xe,{value:t.notes,onChange:s=>m({...t,notes:s.target.value}),placeholder:"Additional information or instructions...",rows:3,className:"text-xs sm:text-sm text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700 border-2 border-gray-400 dark:border-gray-500 placeholder:text-gray-500 dark:placeholder:text-gray-400"})]}),e.jsxs("div",{className:"flex flex-col gap-2 pt-2 sm:pt-4",children:[e.jsxs(c,{onClick:re,className:"flex items-center justify-center gap-2 h-9 sm:h-10 text-xs sm:text-sm w-full",children:[e.jsx(Ce,{className:"w-4 h-4"}),N?"Update":"Save"]}),e.jsx(c,{variant:"outline",onClick:()=>d(!1),className:"h-9 sm:h-10 text-xs sm:text-sm w-full",children:"Cancel"})]})]})]})})})})]})};export{Be as default};
