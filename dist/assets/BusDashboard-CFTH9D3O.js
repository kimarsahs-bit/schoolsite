const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DocumentViewer-B-12NAZG.js","assets/index-vcAYm6vD.js","assets/index-Cucspe7h.css","assets/button-variants-BtDv6DLU.js","assets/zoom-out-Bm9_1osx.js","assets/download-DqcvXZsi.js","assets/copy-Bub14O3W.js","assets/share-2-6yjGy1yT.js"])))=>i.map(i=>d[i]);
import{u as xt,r as l,s as Se,j as e,m as P,B as m,R as gt,g as u,a as h,l as d,_ as ht}from"./index-vcAYm6vD.js";import{M as pt,T as ft,a as bt,L as vt,u as wt}from"./leaflet-CASVTLpX.js";import{C as D,a as V,b as Y,c as q,d as E}from"./card-yB6fowr0.js";import{B as jt}from"./badge-LmcNerN7.js";import{I as w}from"./input-CVoIJ2zH.js";import{T as Fe}from"./textarea-B1JbTjEM.js";import{C as yt}from"./checkbox-B49lUdcQ.js";import{B as Nt}from"./bus-BTxqp6us.js";import{S as He}from"./square-pen-BVw1FIsV.js";import{T as Oe}from"./trash-2-04KiNg8K.js";import{E as St}from"./eye-CF1wM1sA.js";import{C as It}from"./circle-alert-D_zFa0RS.js";import"./index-XrueaTAc.js";const Ct=l.lazy(()=>ht(()=>import("./DocumentViewer-B-12NAZG.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),At="royal-academy-auth-buses",kt="royal-academy-students",S="royal-academy-bus-assignments-global",W="royal-academy-bus-locations",y="royal-academy-bus-messages-global",I="royal-academy-bus-principal-messages",Lt='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="48" height="48"><circle cx="24" cy="24" r="22" fill="#dc2626" stroke="white" stroke-width="3"/><path d="M16 32c0 .88.39 1.67 1 2.22V36c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h8v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1.78c.61-.55 1-1.34 1-2.22V22c0-3.5-3.58-4-8-4s-8 .5-8 4v10zm3.5 1c-.83 0-1.5-.67-1.5-1.5S18.67 30 19.5 30s1.5.67 1.5 1.5S20.33 33 19.5 33zm9 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm1.5-6H18v-5h12v5z" fill="white"/></svg>',Mt=new vt.Icon({iconUrl:"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(Lt),iconSize:[48,48],iconAnchor:[24,48],popupAnchor:[0,-48]}),Tt=({position:j})=>{const a=wt(),J=l.useRef(!1);return l.useEffect(()=>{!a||!a.getSize().x||!a.getSize().y||(J.current?a&&a.getSize().x&&a.getSize().y&&a.panTo([j.lat,j.lng],{animate:!0}):(a.setView([j.lat,j.lng],16),J.current=!0))},[a,j]),null},Vt=()=>{const j=xt(),[a,J]=l.useState(null),[C,$e]=l.useState([]),[f,z]=l.useState([]),[Z,oe]=l.useState(""),[ce,Ie]=l.useState(""),[A,Ce]=l.useState(""),[k,Ae]=l.useState(""),[de,Ke]=l.useState("all"),[B,ke]=l.useState(!1),[Le,Me]=l.useState(null),[Te,x]=l.useState(null),[N,R]=l.useState(null),[Ut,Ve]=l.useState(null),[Q,Ue]=l.useState(!1),[Pe,G]=l.useState([]),[X,me]=l.useState("good"),[_,ee]=l.useState(""),[L,ue]=l.useState("all"),[xe,F]=l.useState(new Set),[ge,Ye]=l.useState(""),[he,qe]=l.useState(""),[pe,We]=l.useState(""),[te,se]=l.useState(null),[ae,re]=l.useState(null),[De,H]=l.useState([]),[ie,fe]=l.useState("good"),[T,O]=l.useState(""),[ne,$]=l.useState([null,null,null,null]),[le,Ee]=l.useState(null),[K,be]=l.useState(null),[ve,ze]=l.useState({show:!1,url:"",name:""}),U=l.useMemo(()=>{var s;return`royal-academy-bus-assignments:${((s=a==null?void 0:a.owner)==null?void 0:s.toLowerCase())||(localStorage.getItem("principalEmail")||"principal.1025@gmail.com").toLowerCase()}`},[a]);l.useEffect(()=>{(async()=>{const s=localStorage.getItem("busUserId");if(localStorage.getItem("busAuth")!=="true"||!s){j("/buses",{replace:!0});return}const n=(await u(At,[])||[]).find(v=>v.id===s)||null;if(!n||n.status!=="active"){localStorage.removeItem("busAuth"),localStorage.removeItem("busUsername"),localStorage.removeItem("busId"),localStorage.removeItem("busUserId"),j("/buses",{replace:!0});return}J(n);const o=await u(kt,[]);$e(o);const c=await u(`royal-academy-bus-assignments:${(n.owner||"").toLowerCase()}`,[]);z(c);const p=(await u(W,[])||[]).find(v=>v.busUserId===n.id);p&&R({lat:p.lat,lng:p.lng});const g=await u(y,[]);G((g||[]).filter(v=>v.busUserId===n.id).sort((v,Ne)=>new Date(Ne.createdAt).getTime()-new Date(v.createdAt).getTime()));const ut=await u(I,[]);H((ut||[]).filter(v=>v.busUserId===n.id).sort((v,Ne)=>new Date(Ne.createdAt).getTime()-new Date(v.createdAt).getTime()))})()},[j]);const Je=async(t,s)=>{var n;const r=(n=t.target.files)==null?void 0:n[0];if(!r)return;const i=await Ge(r);$(o=>o.map((c,b)=>b===s?i:c))},Ze=async()=>{if(!a||!T.trim())return;const t=(a.owner||"").toLowerCase(),r={id:`BUSPRN${Date.now()}`,owner:t,busUserId:a.id,busId:a.busId,from:"bus",type:ie,text:T.trim(),images:ne.filter(Boolean),createdAt:new Date().toISOString(),driverName:a.driverName||a.username};try{const n=[...await u(I,[])||[],r];await h(I,n),H(n.filter(o=>o.busUserId===a.id).sort((o,c)=>new Date(c.createdAt).getTime()-new Date(o.createdAt).getTime())),O(""),$([null,null,null,null]),d.success("Sent to principal")}catch{d.error("Failed to send")}},Qe=async()=>{if(!(!a||!K)&&T.trim())try{const s=(await u(I,[])||[]).map(r=>r.id===K?{...r,type:ie,text:T.trim(),images:ne.filter(Boolean)}:r);await h(I,s),H(s.filter(r=>r.busUserId===a.id).sort((r,i)=>new Date(i.createdAt).getTime()-new Date(r.createdAt).getTime())),O(""),$([null,null,null,null]),be(null),d.success("Message updated")}catch{d.error("Failed to update message")}},Xe=async t=>{if(a&&confirm("Are you sure you want to delete this message?"))try{const r=(await u(I,[])||[]).filter(i=>i.id!==t);await h(I,r),H(r.filter(i=>i.busUserId===a.id).sort((i,n)=>new Date(n.createdAt).getTime()-new Date(i.createdAt).getTime())),d.success("Message deleted")}catch{d.error("Failed to delete message")}},et=t=>{be(t.id),fe(t.type==="reply"?"good":t.type),O(t.text),$(t.images&&t.images.length>0?[...t.images,null,null,null].slice(0,4):[null,null,null,null])};l.useEffect(()=>{if(!U)return;const t=Se(U,s=>{z(Array.isArray(s)?s:[])});return()=>{t==null||t()}},[U]),l.useEffect(()=>{const t=Se(y,s=>{if(!a)return;const r=Array.isArray(s)?s:[];G(r.filter(i=>i.busUserId===a.id).sort((i,n)=>new Date(n.createdAt).getTime()-new Date(i.createdAt).getTime()))});return()=>{try{t()}catch{}}},[a]),l.useEffect(()=>{const t=Se(I,s=>{if(!a)return;const r=Array.isArray(s)?s:[];H(r.filter(i=>i.busUserId===a.id).sort((i,n)=>new Date(n.createdAt).getTime()-new Date(i.createdAt).getTime()))});return()=>{try{t()}catch{}}},[a]),l.useEffect(()=>{(async()=>{if(a)try{const s=(a.owner||"").toLowerCase(),r=await u(S,[]),i=new Map;(r||[]).forEach(n=>i.set(`${n.owner}::${n.studentId}`,n)),f.forEach(n=>{const o=C.find(b=>b.id===n.studentId),c=`${s}::${n.studentId}`;i.set(c,{owner:s,studentId:n.studentId,busUserId:n.busUserId,busId:n.busId,assignedAt:n.assignedAt,studentName:(o==null?void 0:o.name)||"",class:(o==null?void 0:o.class)??"",section:((o==null?void 0:o.section)??"").toString().toUpperCase(),rollNumber:(o==null?void 0:o.rollNumber)??"",trackingStatus:n.trackingStatus||"active",reachedHomeAt:n.reachedHomeAt||void 0})}),await h(S,Array.from(i.values()))}catch{}})()},[f,a,C]);const tt=()=>{localStorage.removeItem("busAuth"),localStorage.removeItem("busUsername"),localStorage.removeItem("busId"),localStorage.removeItem("busUserId"),j("/buses",{replace:!0})},M=l.useMemo(()=>{if(!a)return[];const t=f.filter(r=>r.busUserId===a.id),s=new Set;return t.filter(r=>s.has(r.studentId)?!1:(s.add(r.studentId),!0))},[f,a]),we=l.useMemo(()=>new Set(f.map(t=>t.studentId)),[f]),je=l.useMemo(()=>new Set(M.map(t=>t.studentId)),[M]);l.useMemo(()=>["all","1","2","3","4","5","6","7","8","9","10","11","12"],[]),l.useMemo(()=>["all","A","B","C","D","E"],[]);const Be=l.useMemo(()=>{const t=Z.trim().toLowerCase();return C.filter(s=>!A||String(s.class)===A).filter(s=>!k||String(s.section).toUpperCase()===k.toUpperCase()).filter(s=>de==="not_selected"?!we.has(s.id):de==="selected_only"?je.has(s.id):!we.has(s.id)).filter(s=>!t||s.name.toLowerCase().includes(t)||(s.class||"").toString().toLowerCase().includes(t)||(s.section||"").toString().toLowerCase().includes(t)||String(s.rollNumber).toLowerCase().includes(t))},[C,we,je,Z,A,k,de]),Re=l.useMemo(()=>{const t=ce.trim().toLowerCase();return M.map(s=>({a:s,s:C.find(r=>r.id===s.studentId)})).filter(s=>!!s.s).filter(({s})=>!A||String(s.class)===A).filter(({s})=>!k||String(s.section).toUpperCase()===k.toUpperCase()).filter(({s})=>!t||s.name.toLowerCase().includes(t)||(s.class||"").toString().toLowerCase().includes(t)||(s.section||"").toString().toLowerCase().includes(t)||String(s.rollNumber).toLowerCase().includes(t))},[M,C,ce,A,k]),st=async t=>{if(!a)return;if(je.has(t.id)){d.success("Already added");return}if(f.some(n=>n.studentId===t.id)&&!M.some(n=>n.studentId===t.id)){d.error("Student already assigned to another bus");return}const r=f.filter(n=>!(n.studentId===t.id&&n.busUserId!==a.id)).concat([{studentId:t.id,busUserId:a.id,busId:a.busId,assignedAt:new Date().toISOString(),trackingStatus:"active"}]);await h(U,r)&&z(r);try{const n=await u(S,[]),o=(a.owner||"").toLowerCase(),b=[...(n||[]).filter(p=>!(p.studentId===t.id&&p.owner===o)),{owner:o,studentId:t.id,busUserId:a.id,busId:a.busId,assignedAt:new Date().toISOString(),studentName:t.name,class:t.class,section:String(t.section??"").toUpperCase(),rollNumber:t.rollNumber,trackingStatus:"active"}];await h(S,b)}catch{}},at=async t=>{if(!a)return;const s=f.filter(i=>!(i.studentId===t&&i.busUserId===a.id));await h(U,s)&&z(s);try{const i=await u(S,[]),n=(a.owner||"").toLowerCase(),o=(i||[]).filter(c=>!(c.studentId===t&&c.owner===n));await h(S,o)}catch{}},ye=async(t,s)=>{if(!a)return;const r=f.find(c=>c.studentId===t&&c.busUserId===a.id);if(!r)return;const i={...r,trackingStatus:s,reachedHomeAt:s==="reached_home"?new Date().toISOString():r.reachedHomeAt},n=f.map(c=>c.studentId===t&&c.busUserId===a.id?i:c);await h(U,n)&&z(n);try{const c=await u(S,[]),b=(a.owner||"").toLowerCase(),p=(c||[]).map(g=>g.studentId===t&&g.owner===b?{...g,trackingStatus:s,reachedHomeAt:s==="reached_home"?new Date().toISOString():g.reachedHomeAt}:g);await h(S,p),s==="reached_home"||s==="absent"||d.success("Student tracking activated")}catch(c){console.error("Failed to update global assignments:",c),d.error("Failed to update tracking status globally.")}},rt=()=>{if(console.log("üîµ Use Current Location button clicked"),!("geolocation"in navigator)){console.error("‚ùå Geolocation not supported"),x("Geolocation not supported"),d.error("Geolocation not supported by your browser");return}console.log("üìç Requesting current location..."),x(null),d.info("Getting your location..."),navigator.geolocation.getCurrentPosition(t=>{const{latitude:s,longitude:r,accuracy:i}=t.coords;console.log("‚úÖ Location obtained:",{latitude:s,longitude:r,accuracy:i}),R({lat:s,lng:r}),Ue(!0),x(null),d.success(`Location set successfully! (¬±${Math.round(i)}m accuracy)`)},t=>{console.error("‚ùå Geolocation error:",t),t.code===3?(x("GPS timeout - trying again..."),d.warning("Timeout, trying again with lower accuracy..."),setTimeout(()=>{navigator.geolocation.getCurrentPosition(s=>{const{latitude:r,longitude:i,accuracy:n}=s.coords;console.log("‚úÖ Location obtained (retry):",{latitude:r,longitude:i,accuracy:n}),R({lat:s.coords.latitude,lng:s.coords.longitude}),Ue(!0),x(null),d.success(`Location set! (¬±${Math.round(n)}m accuracy)`)},s=>{console.error("‚ùå Retry failed:",s),x("Unable to get location. Please check GPS settings."),d.error("Unable to get location. Please enable GPS.")},{enableHighAccuracy:!1,timeout:1e4})},1e3)):t.code===1?(x("Location permission denied"),d.error("Please allow location access in your browser settings")):(x("Location error. Please enable GPS and try again."),d.error("Location error. Please enable GPS and try again."))},{enableHighAccuracy:!0,maximumAge:0,timeout:3e4})},it=async()=>{if(!a)return;if(!("geolocation"in navigator)){x("Geolocation not supported");return}x(null);const t=navigator.geolocation.watchPosition(async s=>{const{latitude:r,longitude:i}=s.coords;N&&Ve({...N}),R({lat:r,lng:i}),x(null);try{const n=await u(W,[]),o=(a.owner||"").toLowerCase(),c=g=>g.busUserId===a.id&&g.owner===o,p=[...(n||[]).filter(g=>!c(g)),{owner:o,busUserId:a.id,busId:a.busId,lat:r,lng:i,updatedAt:new Date().toISOString()}];await h(W,p),ke(!0)}catch{x("Failed to update location")}},s=>{s.code===3?(x("GPS timeout - trying again..."),setTimeout(()=>{navigator.geolocation.getCurrentPosition(r=>{R({lat:r.coords.latitude,lng:r.coords.longitude}),x(null)},()=>x("Unable to get location. Please check GPS settings."),{enableHighAccuracy:!1,timeout:1e4})},1e3)):x("Location error. Please enable GPS and try again.")},{enableHighAccuracy:!0,maximumAge:100,timeout:3e4});Me(t)},nt=async()=>{if(Le!=null&&(navigator.geolocation.clearWatch(Le),Me(null)),ke(!1),x(null),!!a)try{const t=await u(W,[]),s=(a.owner||"").toLowerCase(),r=(t||[]).filter(i=>!(i.busUserId===a.id&&i.owner===s));await h(W,r)}catch(t){console.error("Failed to remove location:",t)}},Ge=t=>new Promise((s,r)=>{const i=new FileReader;i.onload=()=>s(i.result),i.onerror=r,i.readAsDataURL(t)}),_e=async(t,s)=>{var n;const r=(n=t.target.files)==null?void 0:n[0];if(!r)return;const i=await Ge(r);s===1?se(i):re(i)},lt=(t,s)=>{F(r=>{const i=new Set(r);return s?i.add(t):i.delete(t),i})},ot=async()=>{if(!a||!_.trim())return;const t=(a.owner||"").toLowerCase(),r={id:`BUSMSG${Date.now()}`,owner:t,busUserId:a.id,busId:a.busId,type:X,text:_.trim(),image1:te||void 0,image2:ae||void 0,createdAt:new Date().toISOString(),to:L==="all"?"all":"student",studentIds:L==="individual"?Array.from(xe):void 0};try{const n=[...await u(y,[])||[],r];await h(y,n),G(n.filter(o=>o.busUserId===a.id).sort((o,c)=>new Date(c.createdAt).getTime()-new Date(o.createdAt).getTime())),ee(""),se(null),re(null),F(new Set),d.success("Message sent")}catch{d.error("Failed to send")}},ct=async()=>{if(!(!a||!le)&&_.trim())try{const s=(await u(y,[])||[]).map(r=>r.id===le?{...r,type:X,text:_.trim(),image1:te||void 0,image2:ae||void 0,to:L==="all"?"all":"student",studentIds:L==="individual"?Array.from(xe):void 0}:r);await h(y,s),localStorage.setItem(y,JSON.stringify(s)),G(s.filter(r=>r.busUserId===a.id).sort((r,i)=>new Date(i.createdAt).getTime()-new Date(r.createdAt).getTime())),ee(""),se(null),re(null),F(new Set),Ee(null),d.success("Message updated")}catch{d.error("Failed to update message")}},dt=async t=>{if(a&&confirm("Are you sure you want to delete this message?"))try{const r=(await u(y,[])||[]).filter(i=>i.id!==t);await h(y,r),localStorage.setItem(y,JSON.stringify(r)),G(r.filter(i=>i.busUserId===a.id).sort((i,n)=>new Date(n.createdAt).getTime()-new Date(i.createdAt).getTime())),d.success("Message deleted")}catch{d.error("Failed to delete message")}},mt=t=>{Ee(t.id),me(t.type),ee(t.text),se(t.image1||null),re(t.image2||null),ue(t.to==="all"?"all":"individual"),t.studentIds?F(new Set(t.studentIds)):F(new Set)};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-royal via-royal/90 to-gold/20 p-4",children:e.jsxs("div",{className:"container mx-auto max-w-4xl",children:[e.jsxs(P.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-0 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-r from-royal to-gold flex items-center justify-center",children:e.jsx(Nt,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg sm:text-2xl font-bold text-white",children:"Bus Dashboard"}),e.jsxs("p",{className:"text-white/80 text-xs sm:text-sm",children:["Welcome ",(a==null?void 0:a.username)||""]})]})]}),e.jsx(m,{onClick:tt,variant:"outline",className:"w-full sm:w-auto text-white border-white/20 hover:bg-white/10",children:"Logout"})]}),e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.135},className:"mt-4",children:e.jsxs(D,{className:"bg-card/95 sm:backdrop-blur-md border-border/50",children:[e.jsxs(V,{className:"p-3 sm:p-6",children:[e.jsx(Y,{className:"text-base sm:text-lg",children:"Message Principal"}),e.jsx(q,{className:"text-xs sm:text-sm",children:"Send a good/bad message to the principal (max 4 images)"})]}),e.jsxs(E,{className:"space-y-3 p-3 sm:p-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(m,{size:"sm",variant:ie==="good"?"default":"outline",onClick:()=>fe("good"),className:"text-xs sm:text-sm",children:"Good ‚òÖ"}),e.jsx(m,{size:"sm",variant:ie==="bad"?"default":"outline",onClick:()=>fe("bad"),className:"text-xs sm:text-sm",children:"Bad ‚≠ï"})]}),e.jsx(Fe,{placeholder:"Type your message to principal...",value:T,onChange:t=>O(t.target.value),className:"text-sm min-h-[80px]"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 sm:gap-3",children:[0,1,2,3].map(t=>e.jsxs("div",{children:[e.jsx(w,{type:"file",accept:"image/*",onChange:s=>Je(s,t),className:"text-xs"}),ne[t]&&e.jsx("img",{src:ne[t],className:"mt-1 h-12 w-12 sm:h-16 sm:w-16 object-cover rounded border"})]},t))}),e.jsxs("div",{className:"flex justify-end gap-2",children:[K&&e.jsx(m,{onClick:()=>{be(null),O(""),$([null,null,null,null])},variant:"outline",size:"sm",className:"text-xs sm:text-sm",children:"Cancel"}),e.jsxs(m,{onClick:K?Qe:Ze,disabled:!T.trim(),size:"sm",className:"text-xs sm:text-sm w-full sm:w-auto",children:[K?"Update":"Send"," to Principal"]})]}),e.jsxs("div",{className:"pt-4 border-t border-border/50",children:[e.jsx("div",{className:"text-xs sm:text-sm font-medium mb-3",children:"Message History"}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-auto pr-1",children:De.length===0?e.jsx("div",{className:"text-center text-muted-foreground text-xs sm:text-sm py-4",children:"No messages yet"}):De.slice(0,20).map(t=>e.jsxs("div",{className:`border rounded p-2 sm:p-3 ${t.from==="bus"?"bg-blue-500/5 border-blue-500/20":"bg-green-500/5 border-green-500/20"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:`text-[10px] sm:text-xs font-medium px-2 py-0.5 rounded ${t.from==="bus"?"bg-blue-500/20 text-blue-600":"bg-green-500/20 text-green-600"}`,children:t.from==="bus"?"You":"Principal"}),e.jsx("span",{className:`text-[10px] sm:text-xs px-2 py-0.5 rounded ${t.type==="good"?"bg-green-500/20 text-green-600":t.type==="bad"?"bg-red-500/20 text-red-600":"bg-gray-500/20 text-gray-600"}`,children:t.type==="good"?"‚òÖ Good":t.type==="bad"?"‚≠ï Bad":"‚Ü© Reply"})]}),e.jsx("div",{className:"text-[10px] sm:text-xs text-muted-foreground",children:new Date(t.createdAt).toLocaleString()})]}),t.from==="bus"&&e.jsxs("div",{className:"flex gap-1",children:[e.jsx(m,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0",onClick:()=>et(t),children:e.jsx(He,{className:"h-3 w-3"})}),e.jsx(m,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 text-red-600",onClick:()=>Xe(t.id),children:e.jsx(Oe,{className:"h-3 w-3"})})]})]}),e.jsx("div",{className:"text-xs sm:text-sm",children:t.text}),t.images&&t.images.length>0&&e.jsx("div",{className:"flex gap-1 sm:gap-2 mt-2 flex-wrap",children:t.images.map((s,r)=>e.jsxs("div",{className:"relative group cursor-pointer",onClick:()=>ze({show:!0,url:s,name:`Principal Reply Photo ${r+1}`}),children:[e.jsx("img",{src:s,className:"h-12 w-12 sm:h-16 sm:w-16 object-cover rounded border"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity rounded",children:e.jsx(St,{className:"h-4 w-4 text-white"})})]},r))})]},t.id))})]})]})]})}),e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"mt-4",children:e.jsxs(D,{className:"bg-card/95 sm:backdrop-blur-md border-border/50",children:[e.jsxs(V,{className:"p-3 sm:p-6",children:[e.jsx(Y,{className:"text-base sm:text-lg",children:"Current Assignment"}),e.jsx(q,{className:"text-xs sm:text-sm",children:"Basic details of your route and bus"})]}),e.jsx(E,{className:"p-3 sm:p-6",children:a?e.jsxs("div",{className:"grid gap-3 sm:gap-4 grid-cols-1 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground",children:"Bus ID"}),e.jsx("div",{className:"font-mono text-xs sm:text-base",children:a.busId})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Status"}),e.jsx(jt,{variant:a.status==="active"?"default":"destructive",children:a.status})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Route"}),e.jsx("div",{className:"font-medium",children:a.routeName||"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Bus Number"}),e.jsx("div",{className:"font-medium",children:a.busNumber||"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Driver"}),e.jsx("div",{className:"font-medium",children:a.driverName||"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Driver Phone"}),e.jsx("div",{className:"font-medium",children:a.driverPhone||"N/A"})]})]}):e.jsx("div",{className:"text-muted-foreground",children:"Loading your details‚Ä¶"})})]})}),e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.13},className:"mt-4",children:e.jsxs(D,{className:"bg-card/95 sm:backdrop-blur-md border-border/50",children:[e.jsxs(V,{className:"p-3 sm:p-6",children:[e.jsx(Y,{className:"text-base sm:text-lg",children:"Send Messages"}),e.jsx(q,{className:"text-xs sm:text-sm",children:"Send good/bad messages to your selected students"})]}),e.jsxs(E,{className:"space-y-3 p-3 sm:p-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(m,{size:"sm",variant:X==="good"?"default":"outline",onClick:()=>me("good"),className:"text-xs sm:text-sm",children:"Good ‚òÖ"}),e.jsx(m,{size:"sm",variant:X==="bad"?"default":"outline",onClick:()=>me("bad"),className:"text-xs sm:text-sm",children:"Bad ‚≠ï"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:flex sm:flex-wrap sm:gap-3",children:[e.jsx(m,{size:"sm",variant:L==="all"?"default":"outline",onClick:()=>ue("all"),className:"text-xs sm:text-sm",children:"Send to All"}),e.jsx(m,{size:"sm",variant:L==="individual"?"default":"outline",onClick:()=>ue("individual"),className:"text-xs sm:text-sm",children:"Filter Student"})]}),L==="individual"&&e.jsxs("div",{className:"space-y-3 border border-border/50 rounded-lg p-3 bg-card/50",children:[e.jsx("div",{className:"text-sm font-medium",children:"Filter by Student Details"}),e.jsxs("div",{className:"grid sm:grid-cols-3 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:"Class"}),e.jsx(w,{type:"text",placeholder:"e.g., 10",className:"text-xs mt-1",value:ge,onChange:t=>Ye(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:"Section"}),e.jsx(w,{type:"text",placeholder:"e.g., A",className:"text-xs mt-1",value:he,onChange:t=>qe(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:"Roll Number"}),e.jsx(w,{type:"text",placeholder:"e.g., 1",className:"text-xs mt-1",value:pe,onChange:t=>We(t.target.value)})]})]}),e.jsx("div",{className:"grid sm:grid-cols-2 gap-2 max-h-44 overflow-auto pr-1",children:M.map(t=>{var c,b,p;const s=C.find(g=>g.id===t.studentId);if(!s)return null;const r=!ge||((c=s.class)==null?void 0:c.toString().includes(ge)),i=!he||((b=s.section)==null?void 0:b.toString().toUpperCase().includes(he.toUpperCase())),n=!pe||((p=s.rollNumber)==null?void 0:p.toString().includes(pe));if(!r||!i||!n)return null;const o=xe.has(s.id);return e.jsxs("label",{className:"flex items-center gap-2 border rounded p-2 hover:bg-muted/50 cursor-pointer transition-colors",children:[e.jsx(yt,{checked:o,onCheckedChange:g=>lt(s.id,!!g)}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:s.name}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Class ",s.class," ‚Ä¢ Section ",s.section," ‚Ä¢ Roll ",s.rollNumber]})]})]},s.id)})})]}),e.jsx("div",{children:e.jsx(Fe,{placeholder:"Type your message...",value:_,onChange:t=>ee(t.target.value),className:"text-sm min-h-[80px]"})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:flex sm:flex-wrap sm:gap-3",children:[e.jsxs("div",{children:[e.jsx(w,{type:"file",accept:"image/*",onChange:t=>_e(t,1),className:"text-xs"}),te&&e.jsx("img",{src:te,alt:"img1",className:"mt-1 h-12 w-12 sm:h-16 sm:w-16 object-cover rounded border"})]}),e.jsxs("div",{children:[e.jsx(w,{type:"file",accept:"image/*",onChange:t=>_e(t,2),className:"text-xs"}),ae&&e.jsx("img",{src:ae,alt:"img2",className:"mt-1 h-12 w-12 sm:h-16 sm:w-16 object-cover rounded border"})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(m,{onClick:le?ct:ot,size:"sm",className:"text-xs sm:text-sm w-full sm:w-auto",children:le?"Update":"Send"})}),Pe.length>0&&e.jsxs("div",{className:"pt-3",children:[e.jsx("div",{className:"text-xs sm:text-sm font-medium mb-2",children:"Recent Messages"}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-auto pr-1",children:Pe.slice(0,10).map(t=>e.jsxs("div",{className:"border rounded p-2 flex items-start gap-2",children:[e.jsx("div",{className:t.type==="good"?"text-green-500":"text-red-500",children:t.type==="good"?"‚òÖ":"‚≠ï"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"text-xs sm:text-sm flex items-center justify-between",children:[e.jsx("div",{children:t.text}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(m,{size:"sm",variant:"outline",className:"h-6 w-6 p-0",onClick:()=>mt(t),children:e.jsx(He,{className:"h-3 w-3"})}),e.jsx(m,{size:"sm",variant:"destructive",className:"h-6 w-6 p-0",onClick:()=>dt(t.id),children:e.jsx(Oe,{className:"h-3 w-3"})})]})]}),e.jsx("div",{className:"text-[10px] sm:text-xs text-muted-foreground",children:new Date(t.createdAt).toLocaleString()}),e.jsxs("div",{className:"flex gap-1 sm:gap-2 mt-1",children:[t.image1&&e.jsx("img",{src:t.image1,className:"h-12 w-12 sm:h-14 sm:w-14 object-cover rounded border"}),t.image2&&e.jsx("img",{src:t.image2,className:"h-12 w-12 sm:h-14 sm:w-14 object-cover rounded border"})]})]})]},t.id))})]})]})]})}),e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.12},className:"mt-4",children:e.jsxs(D,{className:"bg-card/95 sm:backdrop-blur-md border-border/50",children:[e.jsxs(V,{className:"p-3 sm:p-6",children:[e.jsx(Y,{className:"text-base sm:text-lg",children:"Live Tracking"}),e.jsx(q,{className:"text-xs sm:text-sm",children:"Share your live location with students"})]}),e.jsxs(E,{className:"p-3 sm:p-6",children:[e.jsx(D,{className:"mb-4 bg-yellow-50 border-yellow-200",children:e.jsx(E,{className:"py-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(It,{className:"h-5 w-5 text-yellow-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-yellow-800",children:"Warning: Location Accuracy Notice"}),e.jsxs("p",{className:"text-sm text-yellow-700 mt-1",children:[e.jsx("strong",{children:"Use mobile/phone for better accuracy."})," If you use a computer or laptop, you may get false accuracy, meaning a false location. That's why use a mobile phone for a better experience. Mobile phones have built-in GPS, but computers/laptops do not have built-in GPS."]}),e.jsx("p",{className:"text-sm text-yellow-700 mt-2 font-medium",children:"‡§ö‡•á‡§§‡§æ‡§µ‡§®‡•Ä: ‡§∏‡•ç‡§•‡§æ‡§® ‡§∏‡§ü‡•Ä‡§ï‡§§‡§æ ‡§∏‡•Ç‡§ö‡§®‡§æ - ‡§¨‡•á‡§π‡§§‡§∞ ‡§∏‡§ü‡•Ä‡§ï‡§§‡§æ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤/‡§´‡•ã‡§® ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç‡•§ ‡§Ø‡§¶‡§ø ‡§Ü‡§™ ‡§ï‡§Ç‡§™‡•ç‡§Ø‡•Ç‡§ü‡§∞ ‡§Ø‡§æ ‡§≤‡•à‡§™‡§ü‡•â‡§™ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç, ‡§§‡•ã ‡§Ü‡§™‡§ï‡•ã ‡§ó‡§≤‡§§ ‡§∏‡§ü‡•Ä‡§ï‡§§‡§æ ‡§Æ‡§ø‡§≤ ‡§∏‡§ï‡§§‡•Ä ‡§π‡•à, ‡§ú‡§ø‡§∏‡§ï‡§æ ‡§Ö‡§∞‡•ç‡§• ‡§π‡•à ‡§ó‡§≤‡§§ ‡§∏‡•ç‡§•‡§æ‡§®‡•§ ‡§á‡§∏‡•Ä‡§≤‡§ø‡§è ‡§¨‡•á‡§π‡§§‡§∞ ‡§Ö‡§®‡•Å‡§≠‡§µ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§´‡•ã‡§® ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç‡•§ ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§´‡•ã‡§® ‡§Æ‡•á‡§Ç ‡§Ö‡§Ç‡§§‡§∞‡•ç‡§®‡§ø‡§π‡§ø‡§§ ‡§ú‡•Ä‡§™‡•Ä‡§è‡§∏ ‡§π‡•ã‡§§‡§æ ‡§π‡•à, ‡§≤‡•á‡§ï‡§ø‡§® ‡§ï‡§Ç‡§™‡•ç‡§Ø‡•Ç‡§ü‡§∞/‡§≤‡•à‡§™‡§ü‡•â‡§™ ‡§Æ‡•á‡§Ç ‡§Ö‡§Ç‡§§‡§∞‡•ç‡§®‡§ø‡§π‡§ø‡§§ ‡§ú‡•Ä‡§™‡•Ä‡§è‡§∏ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã‡§§‡§æ ‡§π‡•à‡•§"})]})]})})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2",children:[!Q&&!B&&e.jsx(m,{onClick:rt,size:"sm",className:"text-xs sm:text-sm bg-blue-600 hover:bg-blue-700",disabled:!1,children:"üìç Use Current Location"}),B?e.jsx(m,{variant:"outline",onClick:nt,size:"sm",className:"text-xs sm:text-sm",children:"Stop Tracking"}):e.jsx(m,{onClick:it,size:"sm",className:"text-xs sm:text-sm",disabled:!Q,children:Q?"Start Tracking":"Set Location First"}),Te&&e.jsx("span",{className:"text-destructive text-[10px] sm:text-sm",children:Te}),Q&&!B&&e.jsx("span",{className:"text-green-600 text-[10px] sm:text-sm",children:"‚úì Location set"})]}),e.jsx("div",{className:"mt-3 w-full h-48 sm:h-64 rounded-lg overflow-hidden border border-border/50 bg-muted",children:B&&N?e.jsxs(pt,{center:[N.lat,N.lng],zoom:16,preferCanvas:!0,zoomControl:!1,attributionControl:!1,style:{height:"100%",width:"100%"},children:[e.jsx(ft,{attribution:'¬© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsx(bt,{position:[N.lat,N.lng],icon:Mt}),e.jsx(Tt,{position:N})]}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-muted-foreground text-sm",children:N&&!B?"Tracking stopped":"Start tracking to show your live map"})})]})]})}),e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.15},className:"mt-4",children:e.jsxs(D,{className:"bg-card/95 sm:backdrop-blur-md border-border/50",children:[e.jsxs(V,{className:"p-3 sm:p-6",children:[e.jsx(Y,{className:"text-base sm:text-lg",children:"Students"}),e.jsx(q,{className:"text-xs sm:text-sm",children:"Select valid students created by teachers"})]}),e.jsxs(E,{className:"p-3 sm:p-6",children:[e.jsxs("div",{className:"mb-4 grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Class"}),e.jsx(w,{type:"text",placeholder:"Enter class",value:A,onChange:t=>Ce(t.target.value),className:"mt-1 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Section"}),e.jsx(w,{type:"text",placeholder:"Enter section",value:k,onChange:t=>Ae(t.target.value),className:"mt-1 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Roll Number"}),e.jsx(w,{type:"text",placeholder:"Enter roll",value:Z,onChange:t=>oe(t.target.value),className:"mt-1 text-sm"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(m,{variant:"outline",className:"w-full",onClick:()=>{Ce(""),Ae(""),Ke("all"),oe(""),Ie("")},children:"Clear Filters"})})]}),e.jsxs("div",{className:"grid gap-4 sm:gap-6 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"font-medium",children:"Available"}),e.jsx(w,{placeholder:"Search name, class, section, roll",value:Z,onChange:t=>oe(t.target.value),className:"w-full sm:w-56"})]}),e.jsx("div",{className:"space-y-2 max-h-80 overflow-auto pr-1",children:Be.length===0?e.jsx("div",{className:"text-sm text-muted-foreground",children:"No students found"}):Be.map(t=>{const s=M.some(i=>i.studentId===t.id),r=f.some(i=>i.studentId===t.id&&i.busUserId!==(a==null?void 0:a.id));return e.jsxs("div",{className:"flex items-center justify-between rounded border border-border/50 p-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.name}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Class ",t.class," ‚Ä¢ Section ",t.section," ‚Ä¢ Roll ",t.rollNumber]})]}),e.jsx(m,{size:"sm",disabled:r,onClick:()=>st(t),children:s?"Added":r?"Assigned":"Add"})]},t.id)})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"font-medium",children:"Selected"}),e.jsx(w,{placeholder:"Search selected...",value:ce,onChange:t=>Ie(t.target.value),className:"w-full sm:w-56"})]}),e.jsx("div",{className:"space-y-2 max-h-80 overflow-auto pr-1",children:Re.length===0?e.jsx("div",{className:"text-sm text-muted-foreground",children:"No students selected"}):Re.map(({a:t,s})=>e.jsxs("div",{className:"rounded border border-border/50 p-3",children:[e.jsx("div",{className:"flex items-start justify-between mb-2",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Class ",s.class," ‚Ä¢ Section ",s.section," ‚Ä¢ Roll ",s.rollNumber]}),t.trackingStatus&&e.jsxs("div",{className:`text-xs mt-1 inline-flex items-center gap-1 px-2 py-0.5 rounded-full ${t.trackingStatus==="reached_home"?"bg-green-500/20 text-green-400":t.trackingStatus==="absent"?"bg-gray-500/20 text-gray-400":"bg-blue-500/20 text-blue-400"}`,children:[t.trackingStatus==="reached_home"&&"üè† Reached Home",t.trackingStatus==="absent"&&"‚ùå Absent",t.trackingStatus==="active"&&"üöå On Bus"]}),t.reachedHomeAt&&e.jsxs("div",{className:"text-[10px] text-muted-foreground mt-1",children:["Reached at ",new Date(t.reachedHomeAt).toLocaleTimeString()]})]})}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.jsx(m,{size:"sm",variant:t.trackingStatus==="active"?"default":"outline",onClick:()=>ye(s.id,"active"),className:"text-xs",children:"On Bus"}),e.jsx(m,{size:"sm",variant:t.trackingStatus==="reached_home"?"default":"outline",onClick:()=>ye(s.id,"reached_home"),className:"text-xs bg-green-600 hover:bg-green-700",children:"Reached Home"}),e.jsx(m,{size:"sm",variant:t.trackingStatus==="absent"?"default":"outline",onClick:()=>ye(s.id,"absent"),className:"text-xs",children:"Absent"}),e.jsx(m,{size:"sm",variant:"outline",onClick:()=>at(s.id),className:"text-xs text-red-400",children:"Remove"})]})]},t.studentId))})]})]})]})]})}),ve.show&&e.jsx(l.Suspense,{fallback:e.jsx(gt,{}),children:e.jsx(Ct,{documentUrl:ve.url,documentName:ve.name,onClose:()=>ze({show:!1,url:"",name:""})})})]})})};export{Vt as default};
